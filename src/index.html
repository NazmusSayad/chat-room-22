<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading...</title>

    <script>
      class Theme {
        #conf
        constructor({
          root = document.querySelector(`html`),
          rootAtt = "theme",
          dataKey = "theme",
        } = {}) {
          this.#conf = { root, rootAtt, dataKey }
        }

        #selected = () => localStorage.getItem(this.#conf.dataKey)
        #current = () => this.#conf.root.getAttribute(this.#conf.rootAtt)

        #save(theme = null) {
          localStorage.setItem(this.#conf.dataKey, theme)
        }

        #set() {
          const current = this.#selected()

          if (current === "dark") {
            this.dark()
          } else if (current === "light") {
            this.light()
          } else {
            this.default()
          }
        }

        #watch() {
          const media = matchMedia("(prefers-color-scheme: dark)")
          media.onchange = () => {
            this.#set()
          }
        }

        light(save = true) {
          this.#conf.root.setAttribute(this.#conf.rootAtt, "light")
          if (save) this.#save("light")
        }

        dark(save = true) {
          this.#conf.root.setAttribute(this.#conf.rootAtt, "dark")
          if (save) this.#save("dark")
        }

        toggle() {
          const current = this.#current()

          if (current === "dark") {
            this.light()
          } else if (current === "light") {
            this.dark()
          } else {
            this.default()
          }
        }

        default() {
          const media = matchMedia("(prefers-color-scheme: dark)")
          if (media.matches) {
            this.dark(false)
          } else {
            this.light(false)
          }
          localStorage.removeItem(this.#conf.dataKey)
        }

        start() {
          this.#set()
          this.#watch()
        }
      }

      const appTheme = new Theme()
      appTheme.start()
    </script>

    <link rel="shortcut icon" href="./assests/icon.svg" type="image/x-icon" />
    <!-- font awesome -->
    <script src="https://kit.fontawesome.com/31d1a29a39.js" crossorigin="anonymous"></script>
  </head>

  <style>
    @media (prefers-color-scheme: no-preference) {
      body {
        background: black;
        color: white;
      }
    }

    /* Use dark mode */
    @media (prefers-color-scheme: dark) {
      body {
        background: black;
        color: white;
      }
    }

    /* Use light mode */
    @media (prefers-color-scheme: light) {
      body {
        background: white;
        color: black;
      }
    }
  </style>
  <body>
    <main id="root"></main>
  </body>
</html>
